<!DOCTYPE html>
<html lang="bg">

<head>
  <meta charset="UTF-8">
  <title>Профил | DesignRealm</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Profile page sidebar + layout */
    .layout {
      display: flex;
      gap: 1.5rem;
      max-width: 1100px;
      margin: 1.5rem auto;
      padding: 0 1rem;
    }

    .sidebar {
      width: 260px;
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .sidebar h3 {
      margin: 0 0 .75rem 0;
      font-size: .95rem;
    }

    .menu {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: .25rem;
    }

    .menu a {
      display: block;
      padding: .6rem .8rem;
      border-radius: 8px;
      color: var(--text-color, #222);
      text-decoration: none;
    }

    .menu a.active,
    .menu a:hover {
      background: #f3f4f6;
    }

    .content {
      flex: 1;
    }

    .top-actions {
      display: flex;
      gap: .5rem;
      align-items: center;
      justify-content: flex-end;
      margin-bottom: 1rem;
    }

    .small {
      font-size: .9rem;
      color: #666
    }

    @media (max-width:860px) {
      .layout {
        flex-direction: column;
        padding: 0 0.75rem
      }

      .sidebar {
        width: 100%;
        order: 2
      }

      .content {
        order: 1
      }
    }
  </style>
</head>

<body>

  <header>
    <div class="logo">
      <a href="index.html">
        <img src="images/logo_notext.png" alt="DesignRealm Logo" class="logo-img">
        <span>DesignRealm</span>
      </a>
    </div>
    <nav id="nav">
      <a href="index.html">Начало</a>
      <a href="catalog.html">Каталог</a>
      <a href="profile.html" class="active">Профил</a>
    </nav>
    <button id="menu-toggle">☰</button>
  </header>


  <div class="layout">
    <aside class="sidebar" aria-label="Профил меню">
      <h3>Меню</h3>
      <ul class="menu" id="profile-menu">
        <li><a href="#overview" class="active">Преглед</a></li>
        <li><a href="uploads.html">Качвания</a></li>
        <li><a href="favorites.html">Любими</a></li>
        <li><a href="settings.html">Настройки</a></li>
        <li><a href="security.html">Сигурност</a></li>
      </ul>
      <div style="margin-top:1rem" class="small">Бързи действия</div>
      <div style="display:flex;gap:.5rem;margin-top:.5rem">
        <button class="btn" id="edit-profile">Редактирай</button>
        <button class="btn ghost" id="logout">Излез</button>
      </div>
    </aside>

    <main class="content">
      <section class="hero">
        <div class="hero-text">
          <h1>Вашият профил</h1>
          <p class="subtitle">Управлявайте информацията и настройките на своя акаунт.</p>
        </div>
      </section>

      <div class="top-actions">
        <div class="small">Статус: <strong id="profile-status">Активен</strong></div>
        <button class="btn" id="change-password">Промени парола</button>
        <button class="btn danger" id="delete-account">Изтрий акаунт</button>
      </div>

      <section class="card profile-card">
        <div style="display:flex;gap:1rem;align-items:center;">
          <img id="profileAvatar" src="images/avatar_placeholder.png" alt="avatar"
            style="width:96px;height:96px;border-radius:12px;object-fit:cover">

          <div>
            <p><strong>Email:</strong> <span id="profile-email">...</span></p>
            <p><strong>Роля:</strong> <span id="profile-role">...</span></p>
            <a href="upload.html" class="btn">Качи модел</a>
          </div>
        </div>
      </section>

      <section id="overview" style="margin-top:1rem">
        <h3>Преглед</h3>
        <p class="small">Тук ще намерите основна информация за акаунта и бързи връзки.</p>
      </section>

      <a href="index.html" class="btn" style="margin-top:1rem;display:inline-block">← Начало</a>
    </main>
  </div>

  <footer>
    <p>© 2025 DesignRealm. Всички права запазени.</p>
  </footer>

  <script type="module">
    import { auth, db } from "./firebase-init.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    // Populate profile info when user is signed in
    onAuthStateChanged(auth, async user => {
      if (!user) return;
      const emailEl = document.getElementById("profile-email");
      const roleEl = document.getElementById("profile-role");
      if (emailEl) emailEl.textContent = user.email;
      try {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (!snap.exists()) return;

        const data = snap.data();

        // Роля
        if (roleEl) roleEl.textContent = data.role || "user";

        // ✅ АВАТАР
        const avatar = document.getElementById("profileAvatar");
        if (avatar && data.photoURL) {
          avatar.src = data.photoURL;
        }

      } catch (err) {
        console.error(err);
      }
      });

      // Menu interactions
      const menuToggle = document.getElementById('menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', () => {
          // simple toggle for small screens
          sidebar.style.display = (sidebar.style.display === 'none' || getComputedStyle(sidebar).display === 'none') ? 'block' : 'none';
        });
      }

      // Make profile menu links set active
      const menu = document.getElementById('profile-menu');
      if (menu) {
        menu.addEventListener('click', e => {
          const a = e.target.closest('a');
          if (!a) return;
          menu.querySelectorAll('a').forEach(x => x.classList.remove('active'));
          a.classList.add('active');
        });
      }

      // Action buttons
      document.getElementById('edit-profile')?.addEventListener('click', () => {
        const name = prompt('Въведете име за показване (пример):');
        if (name) alert('Промените са записани (демо)');
      });

      document.getElementById('logout')?.addEventListener('click', async () => {
        try {
          await signOut(auth);
          window.location.href = 'index.html';
        } catch (err) {
          console.error(err);
          alert('Грешка при изход.');
        }
      });

      document.getElementById('change-password')?.addEventListener('click', () => {
        const pw = prompt('Въведете новата парола:');
        if (pw) alert('Паролата е обновена (демо).');
      });

      document.getElementById('delete-account')?.addEventListener('click', async () => {
        const ok = confirm('Наистина ли искате да изтриете акаунта си? Тази операция е необратима.');
        if (!ok) return;
        alert('Акаунтът е маркиран за изтриване (демо).');
      });

      // Placeholder functions kept for backward compatibility
      function updateProfile() { console.warn('updateProfile() - demo placeholder'); }
      function changePassword() { console.warn('changePassword() - demo placeholder'); }
      function deleteAccount() { console.warn('deleteAccount() - demo placeholder'); }
  </script>
  <script type="module" src="monitor.js"></script>
</body>

</html>